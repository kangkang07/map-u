!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var s=e();for(var i in s)("object"==typeof exports?exports:t)[i]=s[i]}}(window,(function(){return function(t){var e={};function s(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)s.d(i,r,function(e){return t[e]}.bind(null,r));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){"use strict";s.r(e),s.d(e,"MapEvent",(function(){return c})),s.d(e,"MapView",(function(){return u})),s.d(e,"Circle",(function(){return f})),s.d(e,"Line",(function(){return p})),s.d(e,"Marker",(function(){return g})),s.d(e,"Polygon",(function(){return x})),s.d(e,"Layer",(function(){return k})),s.d(e,"colorUtils",(function(){return C}));const i=(t,e)=>{var s=.017453292519943295,i=Math.cos,r=t[0]*s,n=e[0]*s;s=t[1]*s-e[1]*s;let a=(1-i(n-r)+(1-i(s))*i(r)*i(n))/2;return 12756274*Math.asin(Math.sqrt(a))};const r=[];let n=180;for(let t=0;t<15;t++)r.push(n),n/=3;function a(t){let e=[180,90],s=[-180,-90];return t.forEach(t=>{e[0]=Math.min(t[0],e[0]),e[1]=Math.min(t[1],e[1]),s[0]=Math.max(t[0],s[0]),s[1]=Math.max(t[1],s[1])}),[e,s]}class h{constructor(){this.obj={}}set(t,e){this.obj[t]=e}get(t){return this.obj[t]}forEach(t){for(let e in this.obj){if(!1===t(this.obj[e],e))break}}map(t){let e=[];for(let s in this.obj)e.push(t(this.obj[s],s));return e}}class l{constructor(t){this.elements={},this.zIndex=t}}class o{constructor(){this.id=((t=21)=>{let e="",s=crypto.getRandomValues(new Uint8Array(t));for(;t--;){let i=63&s[t];e+=i<36?i.toString(36):i<62?(i-26).toString(36).toUpperCase():i<63?"_":"-"}return e})(),this.childrenCollection=new h,this.zIndex=0,this.listeners=new Map,this.visible=!0,this.tiles=[],this.dataset={},this.style={strokeColor:"transparent",strokeWidth:1},this._preRender=!1}get preRender(){return this._preRender}set preRender(t){this._preRender=t,t&&!this.canvas&&(this.canvas=document.createElement("canvas"),this.canvas.height=1e3,this.canvas.width=1e3)}async render(t){if(t.offScreen){let e=t.ctx.getImageData(0,0,this.canvas.width,this.canvas.height);return await createImageBitmap(e)}return null}addChildren(t){t.parent=this,t.view=this.view;let e=this.childrenCollection.get(t.zIndex);e||(e=new l(t.zIndex),this.childrenCollection.set(t.zIndex,e)),e.elements[t.id]=t,this.view&&this.view.render()}setChildren(t){this.childrenCollection.forEach(t=>{t.elements={}}),t.forEach(t=>{this.addChildren(t)})}clear(){this.childrenCollection.forEach(t=>{t.elements={}}),this.view&&this.view.render()}setZIndex(t){if(this.parent){let e=this.parent.childrenCollection.get(this.zIndex);e&&delete e.elements[this.id],this.zIndex=t;let s=this.parent.childrenCollection.get(this.zIndex);s||(s=new l(t),this.parent.childrenCollection.set(t,s)),s.elements[this.id]=this}}getZIndex(){return this.zIndex}setView(t){this.view=t,t.render()}eachChildren(t){this.childrenCollection.forEach(e=>{let s=Object.keys(e.elements);for(let i of s){if(!1===t(e.elements[i]))break}})}on(t,e){let s=this.listeners.get(t);s||(s=[],this.listeners.set(t,s)),s.indexOf(e)<0&&s.push(e)}off(t,e){let s=this.listeners.get(t);if(s)if(e){let t=s.indexOf(e);t>=0&&s.splice(t,1)}else this.listeners.delete(t)}trigger(t,e){const s=()=>{e.mapElement=this;let s=this.listeners.get(t);s&&s.forEach(t=>t(e))};if("layer"===this.type){let i=!1;if(this.eachChildren(s=>{if(s.trigger(t,e))return i=!0,!1}),i)return s(),!0}else if(this.contain(e.pos,{x:e.offsetX,y:e.offsetY}))return s(),!0;return!1}renderOffScreen(){var t;"polygon"==(t=this).type||"circle"==t.type||"line"==t.type||t.type}async renderSingle(t,e,s){let i=r[t],n=[[i*e,i*s],[i*(e+1),i*(s+1)]];this.canvas.height=1e3,this.canvas.width=1e3;let a=this.canvas.getContext("2d"),h=await this.render({mapBounds:n,ctx:a,offScreen:!0});this.bitmap=h}}class c extends MouseEvent{static create(t,e,s){let i=t;return i.extData=s,i.pos=e,i}}const d=window.AMap;class u extends o{constructor(t,e){super(),this.h3HexagonStyle={fillColor:"rgba(0,44,222,.3)",strokeWeight:0,strokeColor:"rgba(0,44,222,0)"},this.ready=0,this.readyPromise=null,this.mapBounds=[[0,0],[0,0]],this.renderFlag=!1,this.canvasEvent=null,this.mouseDown=!1,this.mouseDownTime=null,this.zoomLayers=[5,10],this.extraData={},this.view=this,t&&this.init(t,e)}async init(t,e,s=["AMap.MouseTool"]){return this.map=new d.Map(t,e),new Promise((t,e)=>{this.readyPromise={resolve:t,reject:e},this.map.plugin(s,()=>{let e=document.createElement("canvas");this.canvas=e;let s=new d.CustomLayer(e,{map:this.map,zIndex:100});s.render=t=>{let s=this.map.getSize(),i=s.getWidth(),r=s.getHeight(),n=d.Browser.retina;e.width=i,e.height=r,e.style.width=i+"px",e.style.height=r+"px",t||(t={}),void 0===t.callByMap&&(t.callByMap=!0),t.ctx=e.getContext("2d"),t.retina=n,t.canvas=e;let a=this.map.getBounds(),h=a.getNorthEast(),l=a.getSouthWest();this.bounds=[[l.getLng(),l.getLat()],[h.getLng(),h.getLat()]],t.mapBounds=this.mapBounds,this.eachChildren(e=>{e.render(t)})},["click","dblclick","mousemove"].forEach(t=>{e.addEventListener(t,e=>{let s=Date.now()-this.mouseDownTime;if("click"===t&&s>300)return;if(this.mouseDown)return;let i=this.pixelToLngLat(e.offsetX,e.offsetY);const r=c.create(e,i);this.eachChildren(e=>{e.trigger(t,r)})})}),e.addEventListener("mousedown",t=>{this.mouseDownTime=Date.now(),this.mouseDown=!0}),e.addEventListener("mouseup",t=>{this.mouseDown=!1}),this.customCanvasLayer=s,this.ready=1,t()})})}async render(){this.renderFlag=!0,setTimeout(()=>{this.renderFlag&&(this.renderFlag=!1,this.renderedImg=null,this.customCanvasLayer.render({callByMap:!1}))})}contain(t){return!1}makeBounds(){return null}pixelToLngLat(t,e){let[s,i]=this.bounds,r=t/this.canvas.width,n=e/this.canvas.height;return[(i[0]-s[0])*r+s[0],(i[1]-s[1])*(1-n)+s[1]]}lnglatToPixel(t){let[e,s]=this.bounds,i=(t[0]-e[0])/(s[0]-e[0]),r=(t[1]-e[1])/(s[1]-e[1]);return{x:Math.round(i*this.canvas.width),y:Math.round((1-r)*this.canvas.height)}}}new u;class f extends o{constructor(t,e,s){super(),this.type="circle",this.center=t,this.radius=e,this.style=Object.assign({},this.style,s)}async render(t){const{ctx:e}=t;let s=this.style;e.fillStyle=s.fillColor,e.strokeStyle=s.strokeColor,e.lineWidth=s.strokeWidth,e.beginPath();let r=this.view.lnglatToPixel(this.center),n=this.center,a=r,h=this.center.map(t=>t);h[1]>=89?h[1]-=1:h[1]+=1;let l=this.view.lnglatToPixel(h),o=i(n,h),c=Math.sqrt(Math.pow(a.x-l.x,2)+Math.pow(a.y-l.y,2))/o,d=this.radius*c;return e.arc(r.x,r.y,d,0,2*Math.PI),e.closePath(),e.stroke(),e.fill(),super.render(t)}contain(t){let[e,s]=t;return i(t,this.center)<this.radius}makeBounds(){return[[this.center[0]-this.radius,this.center[1]-this.radius],[this.center[0]+this.radius,this.center[1]+this.radius]]}}class p extends o{constructor(t,e){super(),this.path=[],this.containerPath=[],this.pixelPath=[],this.path=t,this.type="line",this.style=Object.assign({},this.style,e)}async render(t){let e=t.ctx;e.fillStyle=this.style.fillColor,e.strokeStyle=this.style.strokeColor,e.lineWidth=this.style.strokeWidth,this.style.opacity&&(e.globalAlpha=this.style.opacity),e.beginPath();for(let t=0;t<this.path.length;t++){let s=this.path[t],i=this.view.lnglatToPixel(s),r=[i.x,i.y];this.pixelPath.push(r),e.lineTo(i.x,i.y)}return e.stroke(),super.render(t)}contain(t){return!1}makeBounds(){return a(this.path)}}class g extends o{constructor(t,e,s){super(),this.pixel={x:0,y:0},this.type="marker",this.location=t,this.style=Object.assign({},this.style,e),this.image=s}async render(t){let e=t.ctx;e.fillStyle=this.style.fillColor,e.strokeStyle=this.style.strokeColor,e.lineWidth=this.style.strokeWidth,this.style.opacity&&(e.globalAlpha=this.style.opacity);let s=this.view.lnglatToPixel(this.location);if(this.pixel=s,this.image){let t=this.image.height||this.image.imgData.height,i=this.image.width||this.image.imgData.width;e.drawImage(this.image.imgData,s.x-i/2,s.y-t/2,i,t)}else e.beginPath(),e.arc(s.x,s.y,this.style.strokeWidth,0,2*Math.PI),e.stroke();return super.render(t)}contain(t,e){return s=e,i=this.pixel,Math.sqrt(Math.pow(s.x-i.x,2)+Math.pow(s.y-i.y,2))<this.style.strokeWidth;var s,i}makeBounds(){return null}}function y(t,e,s,i,r,n){if(n>e&&n>i||n<e&&n<i)return 0;if(i===e)return 0;var a=i<e?1:-1,h=(n-e)/(i-e);1!==h&&0!==h||(a=i<e?.5:-.5);var l=h*(s-t)+t;return l===r?1/0:l>r?a:0}function m(t,e){return Math.abs(t-e)<1e-8}class x extends o{constructor(t,e){super(),this.path=[],this.h3Index="",this.path=t,this.type="polygon",this.style=Object.assign({},this.style,e)}async render(t){let e=t.ctx;e.fillStyle=this.style.fillColor,e.strokeStyle=this.style.strokeColor,e.lineWidth=this.style.strokeWidth,this.style.opacity&&(e.globalAlpha=this.style.opacity),e.beginPath();for(let t=0;t<this.path.length;t++){let s=this.path[t],i=this.view.lnglatToPixel(s);i.x,i.y;e.lineTo(i.x,i.y)}return e.closePath(),e.fill(),e.stroke(),super.render(t)}contain(t){let e=t[0],s=t[1];var i=0;let r=this.path;var n=r[0];if(!n)return!1;for(var a=1;a<r.length;a++){var h=r[a];i+=y(n[0],n[1],h[0],h[1],e,s),n=h}var l=r[0];return m(n[0],l[0])&&m(n[1],l[1])||(i+=y(n[0],n[1],l[0],l[1],e,s)),0!==i}makeBounds(){return a(this.path)}}const v=(t,e=1)=>(4===t.length&&(t="#"+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)+t.charAt(3)+t.charAt(3)),`rgba(${parseInt(t.substr(1,2),16)},${parseInt(t.substr(3,2),16)},${parseInt(t.substr(5,2),16)},${e})`),b=t=>{let e=t.substring(t.indexOf("(")+1,t.length-1).split(",");const s=t=>Number(t).toString(16).padStart(2,"0");return`#${s(e[0])}${s(e[1])}${s(e[2])}`},w=(t,e=1)=>0===t.indexOf("#")?v(t,e):0===t.indexOf("rgb")?v(b(t),e):void 0,M=(t=1)=>`rgba(${Math.round(199*Math.random())},${Math.round(199*Math.random())},${Math.round(199*Math.random())}, ${t})`,C={calcColorLevel:(t,e,s="linear",i=Math.E)=>{let r;return"linear"===s?t/e:"log10"===s?(r=t/e*9+1,Math.log10(r)):"log2"===s?(r=t/e+1,Math.log2(r)):"ln"===s?(r=t/e*(Math.E-1)+1,Math.log(r)):"logx"===s?(r=t/e*(i-1)+1,Math.log(r)/Math.log(i)):void 0},generateColor:M,hex2rgb:v,rgb2hex:b,toRGBA:w,lighter:(t,e)=>{let s=w(t),i=s.substring(s.indexOf("(")+1,s.length-1).split(","),r=i.map(t=>{let s=Number(t);return s*=e,s>255&&(s=255),s});return`rgba(${r[0]},${r[1]},${r[2]},${i[3]})`}};class k extends o{constructor(){super(),this.offscreen=!1,this.offscreenAlpha=1,this.offscreenCanvas=null,this.offScreenImg=null,this.renderBounds=[],this.dataChangedFlag=!1,this.type="layer"}setOffScreen(t,e){this.offscreen=t,t?(this.offscreenCanvas||(this.offscreenCanvas=document.createElement("canvas")),console.log(e,typeof e),void 0!==e&&"number"==typeof e&&(this.offscreenAlpha=e)):this.offscreenCanvas=null}setPreRender(t,e){this.preRender=t,t&&this.setOffScreen(!0,e)}async render(t){return this.eachChildren(e=>{e.render(t)}),super.render(t)}contain(t){let e=!1;return this.eachChildren(s=>{if(s.contain(t))return e=!0,!1}),e}makeBounds(){let t=[180,90],e=[-180,-90];return this.eachChildren(s=>{t[0]=Math.min(t[0],s.bounds[0][0]),t[1]=Math.min(t[1],s.bounds[0][1]),e[0]=Math.max(e[0],s.bounds[1][0]),e[1]=Math.max(e[1],s.bounds[1][1])}),[t,e]}}}])}));