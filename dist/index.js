!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var i=t();for(var r in i)("object"==typeof exports?exports:e)[r]=i[r]}}(window,(function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(r,s,function(t){return e[t]}.bind(null,s));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t),i.d(t,"MapEvent",(function(){return a})),i.d(t,"MapView",(function(){return d})),i.d(t,"Circle",(function(){return m})),i.d(t,"Line",(function(){return y})),i.d(t,"Marker",(function(){return x})),i.d(t,"Polygon",(function(){return w})),i.d(t,"Layer",(function(){return E})),i.d(t,"MarkerLayer",(function(){return P})),i.d(t,"colorUtils",(function(){return I}));class r{constructor(){this.obj={}}set(e,t){this.obj[e]=t}get(e){return this.obj[e]}forEach(e,t){let i=Object.keys(this.obj);t&&i.reverse();for(let t of i){if(!1===e(this.obj[t],t))break}}map(e){let t=[];for(let i in this.obj)t.push(e(this.obj[i],i));return t}}class s{constructor(){this.listeners=new Map}on(e,t){let i=this.listeners.get(e);i||(i=[],this.listeners.set(e,i)),i.indexOf(t)<0&&i.push(t)}off(e,t){let i=this.listeners.get(e);if(i)if(t){let e=i.indexOf(t);e>=0&&i.splice(e,1)}else this.listeners.delete(e)}trigger(e,t,i){let r=this.listeners.get(e);return!(!r||!r.length)&&(i&&i(t),r.forEach(e=>e(t)),!0)}}class n{constructor(e){this.elements={},this.zIndex=e}}class l{constructor(){this.id=((e=21)=>{let t="",i=crypto.getRandomValues(new Uint8Array(e));for(;e--;){let r=63&i[e];t+=r<36?r.toString(36):r<62?(r-26).toString(36).toUpperCase():r<63?"_":"-"}return t})(),this.style={strokeColor:"transparent",strokeWidth:1},this.dataset={},this.childrenSortedMap=new r,this.childrenCollection={},this.zIndex=0,this.eventManager=new s,this.listeners=new Map,this.visible=!0,this.tiles=[],this._preRender=!1}get preRender(){return this._preRender}set preRender(e){this._preRender=e,e&&!this.canvas&&(this.canvas=document.createElement("canvas"),this.canvas.height=1e3,this.canvas.width=1e3)}async render(e){if(!this.visible)return;let t=JSON.parse(JSON.stringify(this.style));return this.style.fillImage&&(t.fillImage.imgData=this.style.fillImage.imgData),this.beforeRender&&!1===this.beforeRender(t)?void 0:(this.customRender&&this.customRender(e,t),null)}renderView(){this.view&&this.view.render()}addChildren(e){e.parent=this,e.view=this.view;let t=this.childrenSortedMap.get(e.zIndex);t||(t=new n(e.zIndex),this.childrenSortedMap.set(e.zIndex,t)),t.elements[e.id]=e,this.view&&this.view.render()}removeChildren(e){if(this.childrenCollection[e.id]){delete this.childrenSortedMap.get(e.zIndex).elements[e.id],delete this.childrenCollection[e.id],e.parent=null,e.view=null,this.view&&this.view.render()}}setChildren(e){this.childrenSortedMap.forEach(e=>{e.elements={}}),e.forEach(e=>{this.addChildren(e)})}clear(e=!0){this.childrenSortedMap.forEach(e=>{e.elements={}}),this.view&&e&&this.view.render()}hide(){this.visible&&(this.visible=!1,this.renderView())}show(){this.visible||(this.visible=!0,this.renderView())}setZIndex(e){if(this.parent){let t=this.parent.childrenSortedMap.get(this.zIndex);t&&delete t.elements[this.id],this.zIndex=e;let i=this.parent.childrenSortedMap.get(this.zIndex);i||(i=new n(e),this.parent.childrenSortedMap.set(e,i)),i.elements[this.id]=this}}getZIndex(){return this.zIndex}setView(e){this.view=e,e.render()}eachChildren(e,t){this.childrenSortedMap.forEach(t=>{let i=Object.keys(t.elements);for(let r of i){if(!1===e(t.elements[r]))return!1}},t)}on(e,t){this.eventManager.on(e,t)}off(e,t){this.eventManager.off(e,t)}trigger(e,t){const i=()=>this.eventManager.trigger(e,t,e=>{e.mapElement=this});if("layer"===this.type){let r=!1;if(this.eachChildren(i=>{if(i.trigger(e,t))return r=!0,!1},!0),r)return i(),!0}else if(this.contain(t.pos,{x:t.offsetX,y:t.offsetY}))return i();return!1}}class a extends MouseEvent{static create(e,t,i){let r=e;return r.extData=i,r.pos=t,r}}class h{constructor(){this.queue=[],this.status="pending"}pending(){this.status="pending"}ready(){for(this.status="ready";this.queue.length;){this.queue.shift()()}}call(e){"pending"===this.status?this.queue.push(e):e()}}const o=window.AMap;class d extends l{constructor(e,t){super(),this.ready=0,this.readyQueue=new h,this.mapBounds=[[0,0],[0,0]],this.renderFlag=!1,this.eventEmptyManager=new s,this.mouseDown=!1,this.mouseDownTime=null,this.zoomLayers=[5,10],this.extraData={},this.view=this,e&&this.init(e,t)}async init(e,t,i=["AMap.MouseTool"]){return this.map=new o.Map(e,t),new Promise((e,t)=>{this.map.plugin(i,()=>{let t=document.createElement("canvas");this.canvas=t;let i=new o.CustomLayer(t,{map:this.map,zIndex:100});i.render=e=>{let i=this.map.getSize(),r=i.getWidth(),s=i.getHeight(),n=o.Browser.retina;t.width=r,t.height=s,t.style.width=r+"px",t.style.height=s+"px",e||(e={}),void 0===e.callByMap&&(e.callByMap=!0),e.ctx=t.getContext("2d"),e.retina=n,e.canvas=t;let l=this.map.getBounds(),a=l.getNorthEast(),h=l.getSouthWest();this.bounds=[[h.getLng(),h.getLat()],[a.getLng(),a.getLat()]],this.zoomLevel=this.map.getZoom(),e.mapBounds=this.mapBounds,this.eachChildren(t=>{t.render(e)})},["click","dblclick","mousemove"].forEach(e=>{t.addEventListener(e,t=>{let i=Date.now()-this.mouseDownTime;if("click"===e&&i>300)return;if(this.mouseDown)return;let r=this.pixelToLngLat(t.offsetX,t.offsetY);const s=a.create(t,r);let n=!1;this.eachChildren(t=>{if(t.trigger(e,s))return n=!0,!1},!0),n||this.eventEmptyManager.trigger(e,s)})}),t.addEventListener("mousedown",e=>{this.mouseDownTime=Date.now(),this.mouseDown=!0}),t.addEventListener("mouseup",e=>{this.mouseDown=!1}),this.customCanvasLayer=i,this.ready=1,this.readyQueue.ready(),e()})})}async render(){this.renderFlag=!0,setTimeout(()=>{this.renderFlag&&(this.renderFlag=!1,this.renderedImg=null,this.customCanvasLayer.render({callByMap:!1}))})}setCity(e){this.readyQueue.call(()=>{this.map.setCity(e,null)})}contain(e){return!1}makeBounds(){return null}pixelToLngLat(e,t){let[i,r]=this.bounds,s=e/this.canvas.width,n=t/this.canvas.height;return[(r[0]-i[0])*s+i[0],(r[1]-i[1])*(1-n)+i[1]]}lnglatToPixel(e){let[t,i]=this.bounds,r=(e[0]-t[0])/(i[0]-t[0]),s=(e[1]-t[1])/(i[1]-t[1]);return{x:r*this.canvas.width,y:(1-s)*this.canvas.height}}}new d;const c=(e,t)=>{var i=.017453292519943295,r=Math.cos,s=e[0]*i,n=t[0]*i;i=e[1]*i-t[1]*i;let l=(1-r(n-s)+(1-r(i))*r(s)*r(n))/2;return 12756274*Math.asin(Math.sqrt(l))};function u(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}const f=[];let p=180;for(let e=0;e<15;e++)f.push(p),p/=3;function g(e){let t=[180,90],i=[-180,-90];return e.forEach(e=>{t[0]=Math.min(e[0],t[0]),t[1]=Math.min(e[1],t[1]),i[0]=Math.max(e[0],i[0]),i[1]=Math.max(e[1],i[1])}),[t,i]}class m extends l{constructor(e,t,i){super(),this.type="circle",this.center=e,this.radius=t,this.style=Object.assign({},this.style,i)}async customRender(e,t){const{ctx:i}=e;i.fillStyle=t.fillColor,i.strokeStyle=t.strokeColor,i.lineWidth=t.strokeWidth,i.globalAlpha=t.opacity||1,i.beginPath();let r=this.view.lnglatToPixel(this.center),s=this.center,n=r,l=this.center.map(e=>e);l[1]>=89?l[1]-=1:l[1]+=1;let a=this.view.lnglatToPixel(l),h=c(s,l),o=Math.sqrt(Math.pow(n.x-a.x,2)+Math.pow(n.y-a.y,2))/h,d=this.radius*o;i.arc(r.x,r.y,d,0,2*Math.PI),i.closePath(),i.stroke(),i.fill()}contain(e){let[t,i]=e;return c(e,this.center)<this.radius}makeBounds(){return[[this.center[0]-this.radius,this.center[1]-this.radius],[this.center[0]+this.radius,this.center[1]+this.radius]]}}class y extends l{constructor(e,t){super(),this.path=[],this.containerPath=[],this.pixelPath=[],this.path=e,this.type="line",this.style=Object.assign({},this.style,t)}async customRender(e,t){let i=e.ctx;i.fillStyle=t.fillColor,i.strokeStyle=t.strokeColor,i.lineWidth=t.strokeWidth,i.globalAlpha=t.opacity||1,i.beginPath();for(let e=0;e<this.path.length;e++){let t=this.path[e],r=this.view.lnglatToPixel(t),s=[r.x,r.y];this.pixelPath.push(s),i.lineTo(r.x,r.y)}i.stroke()}contain(e){return!1}makeBounds(){return g(this.path)}}class x extends l{constructor(e,t){super(),this.pixel={x:0,y:0},this.type="marker",this.location=e,this.style=Object.assign({},this.style,t)}async customRender(e,t){let i=e.ctx;i.fillStyle=t.fillColor,i.strokeStyle=t.strokeColor,i.lineWidth=t.strokeWidth,i.globalAlpha=t.opacity||1;let r=this.view.lnglatToPixel(this.location);this.pixel=r;let s=1;if(this.scale&&(s=this.scale(this.view.zoomLevel)),t.fillImage){let e=t.fillImage.height||t.fillImage.imgData.height,n=t.fillImage.width||t.fillImage.imgData.width;i.drawImage(t.fillImage.imgData,r.x-n/2,r.y-e/2,n*s,e*s)}else i.beginPath(),i.arc(r.x,r.y,t.strokeWidth*s,0,2*Math.PI),i.stroke(),i.fill()}contain(e,t){return this.visible&&u(t,this.pixel)<this.style.strokeWidth}makeBounds(){return null}}function v(e,t,i,r,s,n){if(n>t&&n>r||n<t&&n<r)return 0;if(r===t)return 0;var l=r<t?1:-1,a=(n-t)/(r-t);1!==a&&0!==a||(l=r<t?.5:-.5);var h=a*(i-e)+e;return h===s?1/0:h>s?l:0}function b(e,t){return Math.abs(e-t)<1e-8}class w extends l{constructor(e,t){super(),this.path=[],this.h3Index="",this.path=e,this.type="polygon",this.style=Object.assign({},this.style,t)}async customRender(e,t){let i=e.ctx;i.fillStyle=t.fillColor,i.strokeStyle=t.strokeColor,i.lineWidth=t.strokeWidth,i.globalAlpha=t.opacity||1,i.beginPath();for(let e=0;e<this.path.length;e++){let t=this.path[e],r=this.view.lnglatToPixel(t);r.x,r.y;i.lineTo(r.x,r.y)}i.closePath(),i.fill(),i.stroke()}contain(e){let t=e[0],i=e[1];var r=0;let s=this.path;var n=s[0];if(!n)return!1;for(var l=1;l<s.length;l++){var a=s[l];r+=v(n[0],n[1],a[0],a[1],t,i),n=a}var h=s[0];return b(n[0],h[0])&&b(n[1],h[1])||(r+=v(n[0],n[1],h[0],h[1],t,i)),0!==r}makeBounds(){return g(this.path)}}const M=(e,t=1)=>(4===e.length&&(e="#"+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2)+e.charAt(3)+e.charAt(3)),`rgba(${parseInt(e.substr(1,2),16)},${parseInt(e.substr(3,2),16)},${parseInt(e.substr(5,2),16)},${t})`),k=e=>{let t=e.substring(e.indexOf("(")+1,e.length-1).split(",");const i=e=>Number(e).toString(16).padStart(2,"0");return`#${i(t[0])}${i(t[1])}${i(t[2])}`},C=(e,t=1)=>0===e.indexOf("#")?M(e,t):0===e.indexOf("rgb")?M(k(e),t):void 0,S=(e=1)=>`rgba(${Math.round(199*Math.random())},${Math.round(199*Math.random())},${Math.round(199*Math.random())}, ${e})`,I={calcColorLevel:(e,t,i="linear",r=Math.E)=>{let s;return"linear"===i?e/t:"log10"===i?(s=e/t*9+1,Math.log10(s)):"log2"===i?(s=e/t+1,Math.log2(s)):"ln"===i?(s=e/t*(Math.E-1)+1,Math.log(s)):"logx"===i?(s=e/t*(r-1)+1,Math.log(s)/Math.log(r)):void 0},generateColor:S,hex2rgb:M,rgb2hex:k,toRGBA:C,lighter:(e,t)=>{let i=C(e),r=i.substring(i.indexOf("(")+1,i.length-1).split(","),s=r.map(e=>{let i=Number(e);return i*=t,i>255&&(i=255),i});return`rgba(${s[0]},${s[1]},${s[2]},${r[3]})`}};class E extends l{constructor(){super(),this.type="layer"}async render(e){return this.eachChildren(t=>{t.render(e)}),super.render(e)}contain(e){let t=!1;return this.eachChildren(i=>{if(i.contain(e))return t=!0,!1}),t}customRender(e,t){}makeBounds(){let e=[180,90],t=[-180,-90];return this.eachChildren(i=>{e[0]=Math.min(e[0],i.bounds[0][0]),e[1]=Math.min(e[1],i.bounds[0][1]),t[0]=Math.max(t[0],i.bounds[1][0]),t[1]=Math.max(t[1],i.bounds[1][1])}),[e,t]}}class O extends x{constructor(e){super(e.location,e.style),this.markers=[],this.offset={x:0,y:0},this.numOffset={x:0,y:0},this.textStyle={fontSize:16,color:"black"},this.pixel=e.pixel,this.type="groupmarker"}async customRender(e,t){let i=e.ctx;i.globalAlpha=t.opacity||1;let r=this.pixel;if(t.fillImage){let e=t.fillImage.height||t.fillImage.imgData.height,s=t.fillImage.width||t.fillImage.imgData.width;i.drawImage(t.fillImage.imgData,r.x-s/2+this.offset.x,r.y-e/2,s,e)}let s=this.markers.length.toString();i.font=this.textStyle.fontSize+"px Arial",i.fillStyle=this.textStyle.color;let n=i.measureText(s);i.fillText(s,r.x-n.width/2+this.offset.x+this.numOffset.x,r.y+this.offset.y+this.numOffset.y)}}class P extends E{constructor(){super(...arguments),this.groupedMarkers=[],this.originMarkers=[],this.groupThreshold=0}eachChildren(e){for(let t of this.groupedMarkers){if(!1===e(t))break}for(let t of this.originMarkers){if(!1===e(t))break}}async render(e){let t=[],i=[];super.eachChildren(e=>{let r=Number.MAX_VALUE,s=null;e.pixel=this.view.lnglatToPixel(e.location),e.visible=!0;const n=t=>{let i=t;if(this.canMerge)if(i.markers){if(i.markers.find(t=>!this.canMerge(e,t,this.view.zoomLevel)))return}else if(!this.canMerge(e,t,this.view.zoomLevel))return;let n=u(e.pixel,t.pixel);n<r&&(r=n,s=t)};if(t.forEach(n),i.forEach(n),r<this.groupThreshold&&s){let r=s;r.view=this.view,r.parent=this,r.markers?(r.markers.push(e),e.visible=!1):(r=new O(e),r.markers.push(e),r.markers.push(s),r.on("click",()=>{let e=this.view.map,t=e.getZoom();e.setZoomAndCenter(t+1,r.location)}),s.visible=!1,e.visible=!1,i.splice(i.indexOf(s),1),t.push(r))}else i.push(e)}),this.groupedMarkers=t,this.originMarkers=i,i.forEach(t=>{t.render(e)}),t.forEach(t=>{this.beforeRender&&this.beforeRender(t),t.render(e)})}addChildren(e){e instanceof x?super.addChildren(e):console.warn("marker layer can only add marker")}}}])}));